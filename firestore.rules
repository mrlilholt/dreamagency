rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // 1. USERS: Allow students to read/write their own profile
    match /users/{userId} {
      allow read, update: if request.auth != null;
      allow create: if request.auth != null; 

      match /alerts/{alertId} {
        allow read, write, delete: if request.auth != null;
      }

      match /event_claims/{claimId} {
        allow read, write, delete: if request.auth != null;
      }
    }

    // 2. ACTIVE JOBS: Allow students to create/update their contracts
    match /active_jobs/{jobId} {
      allow read, write: if request.auth != null;
    }

    // 3. CONTRACTS: Read-only for students
    match /contracts/{contractId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null; 
    }

    // 4. SYSTEM: For the 'Market Crash' global event
    match /system/{docId} {
      allow read, write: if request.auth != null;
    }

    // 4b. EVENTS: Special event engine
    match /events/{eventId} {
      allow read, write: if request.auth != null;
    }

    // 5. SHOP ITEMS
    match /shop_items/{itemId} {
      allow read: if request.auth != null;  // Everyone can see the shop
      allow write: if request.auth != null; // Allows you (and technically students) to buy/seed
    }

    // 6. MEDALS / BADGES
    match /badges/{badgeId} {
      allow read: if request.auth != null;  // Students need to read to see profile
      allow write: if request.auth != null; // Admin needs to write to edit
    }

    // 7. SUGGESTIONS
    match /suggestions/{suggestionId} {
      // Allow students to submit
      allow create: if request.auth != null;

      // Allow Admin to Read (Inbox), Update (Mark Read), and Delete
      // (For simplicity, we are allowing any logged-in user to read/write this collection 
      // so your Admin Dashboard works immediately)
      allow read, update, delete: if request.auth != null;
    }

    // 8. DAILY MISSIONS
    // Admins need read/write. Students need read.
    match /daily_missions/{missionId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null; // Ideally restrict to admins later
    }

    // 9. CLASSES (Theme + onboarding lookups)
    match /classes/{classId} {
      allow read, write: if request.auth != null; // tighten later if needed
    }

    // 9. SIDE HUSTLES
    match /side_hustles/{sideHustleId} {
      allow read, write: if request.auth != null; // Ideally restrict writes to admins later
    }

    match /side_hustle_jobs/{jobId} {
      allow read, write: if request.auth != null;
    }
  }
}
